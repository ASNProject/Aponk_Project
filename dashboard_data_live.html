<!DOCTYPE html>
<!--=== Coding by CodingLab | www.codinglabweb.com === -->
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!----======== CSS ======== -->
  <link rel="stylesheet" href="style2.css" />

  <!----===== Iconscout CSS ===== -->
  <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css" />
  <link href="https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css" rel="stylesheet" />

  <!--<title>Admin Dashboard Panel</title>-->
</head>

<body>
  <script>
    window.history.forward();
</script>
  <nav>
    <div class="logo-name">
      <span class="logo_name">Aponk</span>
    </div>
    <div class="menu-items">
      <ul class="nav-links">

        <li>
          <a href="dashboard_data_live.html">
            <i class="uil uil-clock"></i>
            <span class="link-name">LIVE DATA</span>
          </a>
        </li>
        <li>
          <a href="dashboard_data_harian.html">
            <i class="uil uil-analytics"></i>
            <span class="link-name">Harian</span>
          </a>
        </li>
        <li>
          <a href="dashboard_data_bulanan.html">
            <i class="uil uil-analytics"></i>
            <span class="link-name">Bulanan</span>
          </a>
        </li>
        <li>
          <a href="dashboard_data_tahunan.html">
            <i class="uil uil-analytics"></i>
            <span class="link-name">Tahunan</span>
          </a>
        </li>

      </ul>

      <ul class="logout-mode">
        <ul class="nav-links">
          <li>
            <a href="input_pengunjung.html" id="hireBtn">
              <i class="uil uil-share"></i>
              <span class="link-name">Input Data</span>
            </a>
          </li>
          <li>
            <a href="input_rfid_petugas.html" id="hireBtn">
              <i class="uil uil-credit-card"></i>
              <span class="link-name">Input Petugas</span>
            </a>
          </li>
          <li>
            <a href="input_rfid_penduduk.html" id="hireBtn">
              <i class="uil uil-card-atm"></i>
              <span class="link-name">Input Penduduk</span>
            </a>
          </li>
          <li>
            <a href="index.html">
              <i class="uil uil-signout"></i>
              <span class="link-name">Logout</span>
            </a>
          </li>
          <li class="mode">
            <a href="#">
              <i class="uil uil-moon"></i>
              <span class="link-name">Dark Mode</span>
            </a>
            <div class="mode-toggle">
              <span class="switch"></span>
            </div>
          </li>
        </ul>
      </ul>
    </div>
  </nav>


  <section class="dashboard">
    <div class="dash-content">
      <div class="overview">
        <div class="title">
          <i class="uil uil uil-clock-three"></i>
          <span class="text">DATA LIVE</span>
          <span class="text" id="dashboard"></span>
        </div>
        <iframe
          src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d113236.12941828853!2d108.86686015880048!3d-7.719147534403542!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e650c8fdb6518f7%3A0x2d327c00e4bbe57a!2sPulau%20Nusa%20Kambangan!5e0!3m2!1sid!2sid!4v1667478454231!5m2!1sid!2sid"
          width="100%" height="250" style="border: 0; border-radius: 10; margin-bottom: 10px" allowfullscreen=""
          loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
        <div class="boxes">
          <div class="box box1">
            <i class="uil uil-user-circle"></i>
            <span class="text">Petugas</span>
            <span class="number" id="petugas">0</span>
          </div>
          <div class="box box2">
            <i class="uil uil-user-circle"></i>
            <span class="text">Penduduk</span>
            <span class="number" id="penduduk">0</span>
          </div>
          <div class="box box3">
            <i class="uil uil-user-circle"></i>
            <span class="text">Pengunjung</span>
            <span class="number" id="pengunjung">0</span>
          </div>
        </div>
      </div>

      <div class="activity">
        <div class="title" style="margin-top: 20px; margin-bottom: 20px">
          <i class="uil-tachometer-fast-alt"></i>
          <span class="text">Data Lainnya</span>
        </div>

        <div class="boxes1">
          <div class="box1 box11">
            <span class="text1">Laki-laki</span>
            <span class="number1" id="laki">0</span>
          </div>
          <div class="box1 box21">
            <span class="text1">Perempuan</span>
            <span class="number1" id="perempuan">0</span>
          </div>
          <div class="box1 box31">
            <span class="text1">Anak-anak</span>
            <span class="number1" id="anak">0</span>
          </div>
          <div class="box1 box31">
            <span class="text1">Dewasa</span>
            <span class="number1" id="dewasa">0</span>
          </div>
          <div class="box1 box31">
            <span class="text1">Lansia</span>
            <span class="number1" id="lansia">0</span>
          </div>
          <div class="box1 box31">
            <span class="text1">WNI</span>
            <span class="number1" id="wni">0</span>
          </div>
          <div class="box1 box31">
            <span class="text1">WNA</span>
            <span class="number1" id="wna">0</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!--<script src="script.js"></script>-->
  <script>
    const body = document.querySelector("body"),
      modeToggle = body.querySelector(".mode-toggle");
    sidebar = body.querySelector("nav");
    sidebarToggle = body.querySelector(".sidebar-toggle");

    let getMode = localStorage.getItem("mode");
    if (getMode && getMode === "dark") {
      body.classList.toggle("dark");
    }

    let getStatus = localStorage.getItem("status");
    if (getStatus && getStatus === "close") {
      sidebar.classList.toggle("close");
    }

    /*   modeToggle.addEventListener("click", () => {
      body.classList.toggle("dark");
      if (body.classList.contains("dark")) {
        localStorage.setItem("mode", "dark");
      } else {
        localStorage.setItem("mode", "light");
      }
    });

    sidebarToggle.addEventListener("click", () => {
      sidebar.classList.toggle("close");
      if (sidebar.classList.contains("close")) {
        localStorage.setItem("status", "close");
      } else {
        localStorage.setItem("status", "open");
      }
    });*/
  </script>

  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

  <script id="MainScript">
    var firebaseConfig = {
      apiKey: "AIzaSyDMDphm6xCuGC7JQjcLwi4hU3Y5eSsX8jQ",
      authDomain: "aponk-82561.firebaseapp.com",
      databaseURL: "https://aponk-82561-default-rtdb.firebaseio.com",
      projectId: "aponk-82561",
      storageBucket: "aponk-82561.appspot.com",
      messagingSenderId: "814528637046",
      appId: "1:814528637046:web:a246200b62d4e800121757",
      measurementId: "G-0NB8RSBWLV",
    };
    firebase.initializeApp(firebaseConfig);

    var year;
    const y = new Date();
    y.getFullYear();
    year = y.getFullYear();
    const months = [
      "January",
      "February",
      "March",
      "April",
      "May",
      "June",
      "July",
      "August",
      "September",
      "October",
      "November",
      "December",
    ];

    const m = new Date();
    let month = months[m.getMonth()];

    var day;
    const d = new Date();
    d.getDate();
    if (d.getDate <= 10) {
      day = "0" + d.getDate();
    } else {
      day = d.getDate();
    }
    //console.log(month);

    let ref_tap_rfid = firebase
      .database().ref()
      .child("tapping_kartu");
    ref_tap_rfid.on("value", (snapshot) => {
      tap_rfid = snapshot.val();
      //console.log(tap_rfid);
      //parseInt(tap_rfid);   
      $(function () {
        toastr.options = {
          "closeButton": false,
          "debug": false,
          "newestOnTop": true,
          "progressBar": true,
          "positionClass": "toast-top-right",
          "preventDuplicates": false,
          "onclick": null,
          "showDuration": "300",
          "hideDuration": "1000",
          "timeOut": "5000",
          "extendedTimeOut": "1000",
          "showEasing": "swing",
          "hideEasing": "linear",
          "showMethod": "show",
          "hideMethod": "hide"
        }
        var notif_time = d.toLocaleString();
        if (tap_rfid == "1") toastr.success(notif_time, 'Data MASUK')
        if (tap_rfid == "2") toastr.success(notif_time, 'Data KELUAR')
        //document.getElementById("pengunjung").innerHTML = tap_rfid;
      });
    });

    //GET DATA HARIAN
    var ref1 = firebase
      .database()
      .ref()
      .child("DataHarian")
      .child(year)
      .child(month)
      .child(day)
      .child("Petugas");

    var ref2 = firebase
      .database()
      .ref()
      .child("DataHarian")
      .child(year)
      .child(month)
      .child(day)
      .child("Penduduk");

    var ref3 = firebase
      .database()
      .ref()
      .child("DataHarian")
      .child(year)
      .child(month)
      .child(day)
      .child("Pengunjung");

    var ref4 = firebase
      .database()
      .ref()
      .child("DataHarian")
      .child(year)
      .child(month)
      .child(day)
      .child("Laki-Laki");

    var ref5 = firebase
      .database()
      .ref()
      .child("DataHarian")
      .child(year)
      .child(month)
      .child(day)
      .child("Perempuan");

    var ref6 = firebase
      .database()
      .ref()
      .child("DataHarian")
      .child(year)
      .child(month)
      .child(day)
      .child("Anak-anak");

    var ref7 = firebase
      .database()
      .ref()
      .child("DataHarian")
      .child(year)
      .child(month)
      .child(day)
      .child("Dewasa");

    var ref8 = firebase
      .database()
      .ref()
      .child("DataHarian")
      .child(year)
      .child(month)
      .child(day)
      .child("Lansia");

    var ref9 = firebase
      .database()
      .ref()
      .child("DataHarian")
      .child(year)
      .child(month)
      .child(day)
      .child("WNI");

    var ref10 = firebase
      .database()
      .ref()
      .child("DataHarian")
      .child(year)
      .child(month)
      .child(day)
      .child("WNA");

    $(document).ready(
      function () {
        setInterval(function () {
          ref1.once("value").then(function (snapshot) {
            //console.log(snapshot.numChildren());
            //document.getElementById("petugas").innerHTML = snapshot.numChildren();
            //console.log(day);
            var petugasmasuk = snapshot.numChildren();

            var ref1s = firebase
              .database()
              .ref()
              .child("DataKeluar")
              .child(year)
              .child(month)
              .child(day)
              .child("Petugas");
            ref1s.once("value").then(function (snapshot) {
              // console.log(snapshot.numChildren());
              // document.getElementById("petugas").innerHTML = snapshot.numChildren();
              //console.log(day);
              var petugaskeluar = snapshot.numChildren();

              //console.log(petugasmasuk - petugaskeluar);
              document.getElementById("petugas").innerHTML =
                petugasmasuk - petugaskeluar;
            });
          });

          ref2.once("value").then(function (snapshot) {
            var pendudukmasuk = snapshot.numChildren();
            var ref2s = firebase
              .database()
              .ref()
              .child("DataKeluar")
              .child(year)
              .child(month)
              .child(day)
              .child("Penduduk");
            ref2s.once("value").then(function (snapshot) {
              var pendudukkeluar = snapshot.numChildren();
              // console.log(snapshot.numChildren());
              document.getElementById("penduduk").innerHTML =
                pendudukmasuk - pendudukkeluar;
              //console.log(day);
            });
          });

          ref3.once("value").then(function (snapshot) {
            var pengunjungmasuk = snapshot.numChildren();
            var ref3s = firebase
              .database()
              .ref()
              .child("DataKeluar")
              .child(year)
              .child(month)
              .child(day)
              .child("Pengunjung");
            ref3s.once("value").then(function (snapshot) {
              var pengunjungkeluar = snapshot.numChildren();
              //console.log(snapshot.numChildren());
              document.getElementById("pengunjung").innerHTML =
                pengunjungmasuk - pengunjungkeluar;
              //  snapshot.numChildren();
              //  console.log(day);
            });
          });

          ref4.once("value").then(function (snapshot) {
            var lakilakimasuk = snapshot.numChildren();
            var ref4s = firebase
              .database()
              .ref()
              .child("DataKeluar")
              .child(year)
              .child(month)
              .child(day)
              .child("Laki-Laki");
            ref4s.once("value").then(function (snapshot) {
              var lakilakikeluar = snapshot.numChildren();
              //console.log(snapshot.numChildren());
              document.getElementById("laki").innerHTML =
                lakilakimasuk - lakilakikeluar;
              //console.log(day);
            });
          });

          ref5.once("value").then(function (snapshot) {
            var perempuanmasuk = snapshot.numChildren();
            var ref5s = firebase
              .database()
              .ref()
              .child("DataKeluar")
              .child(year)
              .child(month)
              .child(day)
              .child("Perempuan");
            ref5s.once("value").then(function (snapshot) {
              var perempuankeluar = snapshot.numChildren();
              document.getElementById("perempuan").innerHTML =
                perempuanmasuk - perempuankeluar;
              //console.log(snapshot.numChildren());
              //document.getElementById("perempuan").innerHTML = snapshot.numChildren();
              //console.log(day);
            });
          });

          ref6.once("value").then(function (snapshot) {
            var anakanakmasuk = snapshot.numChildren();
            var ref6s = firebase
              .database()
              .ref()
              .child("DataKeluar")
              .child(year)
              .child(month)
              .child(day)
              .child("Anak-anak");
            ref6s.once("value").then(function (snapshot) {
              var anakanakkeluar = snapshot.numChildren();
              // console.log(snapshot.numChildren());
              document.getElementById("anak").innerHTML =
                anakanakmasuk - anakanakkeluar;
              //console.log(day);
            });
          });

          ref7.once("value").then(function (snapshot) {
            var dewasamasuk = snapshot.numChildren();
            var ref7s = firebase
              .database()
              .ref()
              .child("DataKeluar")
              .child(year)
              .child(month)
              .child(day)
              .child("Dewasa");
            ref7s.once("value").then(function (snapshot) {
              var dewasakeluar = snapshot.numChildren();
              // console.log(snapshot.numChildren());
              document.getElementById("dewasa").innerHTML =
                dewasamasuk - dewasakeluar;
              //console.log(day);
            });
          });

          ref8.once("value").then(function (snapshot) {
            var lansiamasuk = snapshot.numChildren();
            var ref8s = firebase
              .database()
              .ref()
              .child("DataKeluar")
              .child(year)
              .child(month)
              .child(day)
              .child("Lansia");
            ref8s.once("value").then(function (snapshot) {
              var lansiakeluar = snapshot.numChildren();
              //console.log(snapshot.numChildren());
              document.getElementById("lansia").innerHTML =
                lansiamasuk - lansiakeluar;
              //console.log(day);
            });
          });

          ref9.once("value").then(function (snapshot) {
            var wnimasuk = snapshot.numChildren();
            var ref9s = firebase
              .database()
              .ref()
              .child("DataKeluar")
              .child(year)
              .child(month)
              .child(day)
              .child("WNI");
            ref9s.once("value").then(function (snapshot) {
              var wnikeluar = snapshot.numChildren();
              // console.log(snapshot.numChildren());
              document.getElementById("wni").innerHTML = wnimasuk - wnikeluar;
              //console.log(day);
            });
          });

          ref10.once("value").then(function (snapshot) {
            var wnamasuk = snapshot.numChildren();
            var ref10s = firebase
              .database()
              .ref()
              .child("DataKeluar")
              .child(year)
              .child(month)
              .child(day)
              .child("WNA");
            ref10s.once("value").then(function (snapshot) {
              var wnakeluar = snapshot.numChildren();
              // console.log(snapshot.numChildren());
              document.getElementById("wna").innerHTML = wnamasuk - wnakeluar;
              //console.log(day);
            });
          });

          var tanggalan = new Date();

          var day_x = tanggalan.getDate();
          var month_x = tanggalan.getMonth() + 1;
          var year_x = tanggalan.getFullYear();
          var hour_x = tanggalan.getHours();
          var minute_x = tanggalan.getMinutes();
          var second_x = tanggalan.getSeconds();

          if (day_x.toString().length < 2) day_x = '0' + day_x;
          if (month_x.toString().length < 2) month_x = '0' + month_x;
          if (hour_x.toString().length < 2) hour_x = '0' + hour_x;
          if (minute_x.toString().length < 2) minute_x = '0' + minute_x;
          if (second_x.toString().length < 2) second_x = '0' + second_x;

          var date_time_x = ("  :  " + day + "-" + month + "-" + year + " | " + hour_x + ":" + minute_x + ":" + second_x);

          document.getElementById("dashboard").innerHTML = date_time_x;

          // $('#petugas').text(data_petugas);
          // $('#penduduk').text(data_penduduk);
          // // $('#pengunjung').text(data_pengunjung);
          // $('#laki').text(data_laki);
          // $('#perempuan').text(data_perempuan);
          // $('#anak').text(data_anak);
          // $('#lansia').text(data_lansia);
          // $('#dewasa').text(data_dewasa);
          // $('#wni').text(data_wni);
          // $('#wna').text(data_wna);
        }, 1000);
      });
  </script>
</body>

</html>